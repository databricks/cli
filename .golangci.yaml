version: "2"
linters:
  default: none
  enable:
    - bodyclose
    - errcheck
    - gocritic
    - govet
    - ineffassign
    - intrange
    - mirror
    - perfsprint
    - staticcheck
    - testifylint
    - unconvert
    - unused
    - exhaustruct
    - copyloopvar
    - gosec
  settings:
    copyloopvar:
      check-alias: true
    errcheck:
      exclude-functions:
        - (*github.com/spf13/cobra.Command).RegisterFlagCompletionFunc
        - (*github.com/spf13/cobra.Command).MarkFlagRequired
        - (*github.com/spf13/pflag.FlagSet).MarkDeprecated
        - (*github.com/spf13/pflag.FlagSet).MarkHidden
    gosec:
      # Only exclude rules that currently fire in this repository
      excludes:
        - G101 # Hardcoded credentials
        - G107 # Url provided to HTTP request as taint input
        - G110 # Potential DoS vulnerability via decompression bomb
        - G112 # Potential Slowloris attack
        - G115 # Potential integer overflow when converting between integer types
        - G204 # Audit use of command execution
        - G306 # Poor file permissions used when writing to a new file
        - G401 # Use of weak cryptographic primitive (MD5/SHA1)
        - G404 # Insecure random number source (rand)
        - G501 # Import blocklist: crypto/md5
        - G602 # Slice access out of bounds
    gocritic:
      disable-all: true
      enabled-checks:
        - ruleguard
      settings:
        ruleguard:
          failOn: all
          rules: libs/gorules/rule_*.go
    govet:
      disable:
        - fieldalignment
        - shadow
      enable-all: true
      settings:
        printf:
          funcs:
            - (github.com/databricks/cli/internal/testutil.TestingT).Infof
            - (github.com/databricks/cli/internal/testutil.TestingT).Errorf
            - (github.com/databricks/cli/internal/testutil.TestingT).Fatalf
            - (github.com/databricks/cli/internal/testutil.TestingT).Skipf
    staticcheck:
      checks:
        - all
        # disabled checks:
        - -ST1003
    testifylint:
      enable-all: true
      disable:
        - require-error # good check, but we have too many assert.(No)?Errorf? so excluding for now
        - empty
        - len
        - equal-values
        - encoded-compare # Always replaces Equal() with JSONEq, but sometimes exact string match is wanted for JSON
  exclusions:
    generated: lax
    presets:
      - comments
      - common-false-positives
      - legacy
      - std-error-handling
    rules:
      - path-except: bundle/terranova/tnresources
        linters:
          - exhaustruct
issues:
  max-issues-per-linter: 1000
  max-same-issues: 1000
formatters:
  enable:
    - gofmt
    - gofumpt
    - goimports
  settings:
    gofmt:
      rewrite-rules:
        - pattern: a[b:len(a)]
          replacement: a[b:]
        - pattern: interface{}
          replacement: any
    gofumpt:
      module-path: github.com/databricks/cli
      extra-rules: true
  exclusions:
    generated: lax
