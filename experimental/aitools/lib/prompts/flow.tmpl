{{- /*
     * L1: Universal workflow guidance for Databricks AI Tools MCP server.
     *
     * This guidance is always provided by databricks_discover.
     * Contains: available tools, CLI patterns, best practices.
     */ -}}

## Databricks AI Tools Available MCP Tools
- **databricks_discover**: MUST call first - returns scaffolding commands
- **invoke_databricks_cli**: Execute CLI commands including init-template for scaffolding
- **databricks_configure_auth**: Switch workspace profile/host

## Critical Workflow Rules
1. ALWAYS call databricks_discover FIRST to get scaffolding guidance
2. For new apps: use invoke_databricks_cli with init-template (see below)
3. For scaffolding: NEVER use `npm create vite` or `npx create-vite` - init-template creates proper Databricks bundle
4. For development: `npm run dev`, `npm install`, `npm run build` are OK after scaffolding
5. Validate before deploying
6. Ask for confirmation on live environment changes

{{.WorkspaceInfo}}{{if .WarehouseName}}
Default SQL Warehouse: {{.WarehouseName}} ({{.WarehouseID}}){{else}}
Note: No SQL warehouse detected. SQL queries will require warehouse_id to be specified manually.{{end}}{{.ProfilesInfo}}

## Universal Databricks CLI Patterns
Use `invoke_databricks_cli '<command>'` to run any Databricks CLI command.

### Project scaffolding

IMPORTANT: Always use 'experimental aitools tools init-template' commands below instead of 'databricks bundle init'.
The init-template commands create agent-friendly projects with AGENTS.md/CLAUDE.md guidance files and proper MCP integration.

For apps:
invoke_databricks_cli 'experimental aitools tools init-template app --name my-app --description "My app description"'

For agents (Conversational AI with OpenAI Agents SDK):
invoke_databricks_cli 'experimental aitools tools init-template agent --name my_agent'
Note: Creates Python agent with OpenAI Agents SDK, Claude model, MLflow tracing, and MCP integration

For jobs (Python notebooks with wheel package):
invoke_databricks_cli 'experimental aitools tools init-template job --name my_job'
invoke_databricks_cli 'experimental aitools tools init-template job --name my_job --catalog my_catalog'

For pipelines (Lakeflow Declarative Pipelines):
invoke_databricks_cli 'experimental aitools tools init-template pipeline --name my_pipeline --language python'
invoke_databricks_cli 'experimental aitools tools init-template pipeline --name my_pipeline --language sql --catalog my_catalog'
Note: --language is required (python or sql). Ask the user which language they prefer:
  - SQL: Recommended for straightforward transformations (filters, joins, aggregations)
  - Python: Recommended for complex logic (custom UDFs, ML, advanced processing)

For custom resources (dashboards, alerts, model serving, etc.):
invoke_databricks_cli 'experimental aitools tools init-template empty --name my_project'
Note: Use this for resources OTHER than apps, jobs, or pipelines

Notes:
- App name must be â‰¤26 characters (dev- prefix adds 4 chars, max total 30)
- Agent/job/pipeline/project names: letters, numbers, underscores only
- --catalog defaults to workspace default catalog{{if .DefaultCatalog}} (currently '{{.DefaultCatalog}}'){{end}}

### Custom SQL Queries

invoke_databricks_cli 'experimental aitools tools query "SELECT * FROM catalog.schema.table LIMIT 10"'

### Exploring Resources
Jobs:
  invoke_databricks_cli 'jobs list'
  invoke_databricks_cli 'jobs get <job_id>'

Clusters:
  invoke_databricks_cli 'clusters list'

Unity Catalog:
  invoke_databricks_cli 'catalogs list'
  invoke_databricks_cli 'schemas list <catalog>'
  invoke_databricks_cli 'tables list <catalog> <schema>'
  invoke_databricks_cli 'experimental aitools tools discover-schema TABLE1 TABLE2 TABLE3'

Use separate arguments for catalog/schema: 'tables list samples tpcds_sf1' (not dot notation).
Dot notation is only supported in `experimental aitools tools discover-schema` and `experimental aitools tools query`.

It is STRONGLY RECOMMENDED to delegate the task of exploring catalogs, schemas, or tables in Unity Catalog to an Explore agent or a sub agent.
