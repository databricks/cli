export username=$($CLI current-user me | jq -r .userName)

# TODO CONTINUE(v5): Figure out why this is failing on windows, and it automatically
# being recorded as as  windows file without quotes. Why the difference?
# test run: https://github.com/databricks-eng/eng-dev-ecosystem/actions/runs/14647936035/job/41106657293
title "create a folder"
trace $CLI workspace mkdirs /Users/$username/$UNIQUE_NAME

title "upload a file"
trace $CLI workspace import /Users/$username/$UNIQUE_NAME/hello.txt --format AUTO --file ./hello.txt

title "list the folder"
trace $CLI workspace list /Users/$username/$UNIQUE_NAME --output json | jq '.[] | {path, object_type}'

title "stat the file"
trace $CLI workspace get-status /Users/$username/$UNIQUE_NAME/hello.txt | jq '{path, object_type}'

title "download the file"
trace $CLI workspace export /Users/$username/$UNIQUE_NAME/hello.txt --format AUTO --file ./hello2.txt

trace cat hello2.txt
rm hello2.txt

title "delete the file"
trace $CLI workspace delete /Users/$username/$UNIQUE_NAME/hello.txt

title "stat the file again"
errcode trace $CLI workspace get-status /Users/$username/$UNIQUE_NAME/hello.txt

title "list the folder"
trace $CLI workspace list /Users/$username/$UNIQUE_NAME

title "delete the folder"
trace $CLI workspace delete /Users/$username/$UNIQUE_NAME

title "list the folder again"
errcode trace $CLI workspace list /Users/$username/$UNIQUE_NAME
