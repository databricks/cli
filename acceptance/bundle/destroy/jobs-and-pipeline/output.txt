
=== Assert the snapshot file does not exist:
Directory does not exist

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/[UNIQUE_NAME]/files...
Deploying resources...
Updating deployment state...
Deployment complete!

=== Assert the snapshot file exists
>>> find.py --expect 1 ^.databricks/bundle/default/sync-snapshots/[a-z0-9]+\.json

=== Assert bundle deployment path is created
>>> [CLI] workspace get-status //Workspace/Users/[USERNAME]/.bundle/[UNIQUE_NAME]
{
  "path": "/Workspace/Users/[USERNAME]/.bundle/[UNIQUE_NAME]",
  "object_type": "DIRECTORY"
}

=== Assert the pipeline is created
>>> [CLI] pipelines get [UUID]
{
  "spec": {
    "channel": "CURRENT",
    "deployment": {
      "kind": "BUNDLE",
      "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/[UNIQUE_NAME]/state/metadata.json"
    },
    "edition": "ADVANCED",
    "id": "[UUID]",
    "libraries": [
      {
        "file": {
          "path": "/Workspace/Users/[USERNAME]/.bundle/[UNIQUE_NAME]/files/foo.py"
        }
      }
    ],
    "name": "test-bundle-pipeline-[UNIQUE_NAME]",
    "storage": "dbfs:/pipelines/[UUID]"
  }
}

=== Assert the job is created:
{
  "name": "test-bundle-job-[UNIQUE_NAME]"
}

=== Destroy bundle
>>> [CLI] bundle destroy --auto-approve
Error: Failed to acquire deployment lock: deploy lock acquired by [USERNAME] at [TIMESTAMP] +0100 CET. Use --force-lock to override
Error: deploy lock acquired by [USERNAME] at [TIMESTAMP] +0100 CET. Use --force-lock to override


Exit code: 1
