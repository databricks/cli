print_requests() {
    jq --sort-keys 'select(.path=="/api/2.2/jobs/run-now")' < out.requests.txt
    rm out.requests.txt
}

trace $CLI bundle deploy

trace $CLI bundle run my_job --tasks task_1
trace print_requests

trace $CLI bundle run my_job --tasks task_1,task_2
trace print_requests

trace $CLI bundle run my_job
trace print_requests

# We expect an error because the task does not exist
trace musterr $CLI bundle run my_job --tasks non_existent_task

# We expect an error because one of the tasks does not exist
trace musterr $CLI bundle run my_job --tasks non_existent_task,task_1

rm out.requests.txt
