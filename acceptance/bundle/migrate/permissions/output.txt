
>>> DATABRICKS_BUNDLE_ENGINE=terraform [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/migrate-basic-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> [CLI] bundle deployment migrate
Note: Migration should be done after a full deploy. Running plan now to verify that deployment was done:
Plan: 0 to add, 0 to change, 0 to delete, 4 unchanged
Success! Migrated 4 resources to direct engine state file: [TEST_TMP_DIR]/.databricks/bundle/default/resources.json

Validate the migration by running "databricks bundle plan", there should be no actions planned.

The state file is not synchronized to the workspace yet. To do that and finalize the migration, run "bundle deploy".

To undo the migration, remove [TEST_TMP_DIR]/.databricks/bundle/default/resources.json and rename [TEST_TMP_DIR]/.databricks/bundle/default/terraform/terraform.tfstate.backup to [TEST_TMP_DIR]/.databricks/bundle/default/terraform/terraform.tfstate


>>> DATABRICKS_BUNDLE_ENGINE=terraform musterr [CLI] bundle plan
Error: Required engine "terraform" does not match present state files. Clear "DATABRICKS_BUNDLE_ENGINE" env var to use engine appropriate for the state.

Available state files:
- terraform.tfstate: remote terraform state serial=5 lineage="[UUID]"
- [TEST_TMP_DIR]/.databricks/bundle/default/resources.json: local direct state serial=7 lineage="[UUID]"


>>> DATABRICKS_BUNDLE_ENGINE=terraform musterr [CLI] bundle deploy
Error: Required engine "terraform" does not match present state files. Clear "DATABRICKS_BUNDLE_ENGINE" env var to use engine appropriate for the state.

Available state files:
- terraform.tfstate: remote terraform state serial=5 lineage="[UUID]"
- [TEST_TMP_DIR]/.databricks/bundle/default/resources.json: local direct state serial=7 lineage="[UUID]"


>>> DATABRICKS_BUNDLE_ENGINE=direct [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 4 unchanged

>>> DATABRICKS_BUNDLE_ENGINE= [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 4 unchanged

>>> print_requests.py --get //jobs/get
{
  "headers": {
    "User-Agent": [
      "cli/[DEV_VERSION] databricks-sdk-go/[SDK_VERSION] go/[GO_VERSION] os/[OS] cmd/bundle_plan cmd-exec-id/[UUID] engine/direct auth/pat"
    ]
  },
  "method": "GET",
  "path": "/api/2.2/jobs/get",
  "q": {
    "job_id": "[NUMID]"
  }
}
{
  "headers": {
    "User-Agent": [
      "cli/[DEV_VERSION] databricks-sdk-go/[SDK_VERSION] go/[GO_VERSION] os/[OS] cmd/bundle_plan cmd-exec-id/[UUID] engine/direct auth/pat"
    ]
  },
  "method": "GET",
  "path": "/api/2.2/jobs/get",
  "q": {
    "job_id": "[NUMID]"
  }
}

>>> DATABRICKS_BUNDLE_ENGINE= [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/migrate-basic-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests.py --get //jobs/get
"cli/[DEV_VERSION] databricks-sdk-go/[SDK_VERSION] go/[GO_VERSION] os/[OS] cmd/bundle_deploy cmd-exec-id/[UUID] engine/direct auth/pat"
"cli/[DEV_VERSION] databricks-sdk-go/[SDK_VERSION] go/[GO_VERSION] os/[OS] cmd/bundle_deploy cmd-exec-id/[UUID] engine/direct auth/pat"

=== Should show that it's already migrated
>>> musterr [CLI] bundle deployment migrate
Error: already using direct engine
Details: [TEST_TMP_DIR]/.databricks/bundle/default/resources.json: local direct state serial=8 lineage="[UUID]"

>>> DATABRICKS_BUNDLE_ENGINE= [CLI] bundle debug states
[TEST_TMP_DIR]/.databricks/bundle/default/resources.json: local direct state serial=8 lineage="[UUID]"

>>> DATABRICKS_BUNDLE_ENGINE= [CLI] bundle debug states --force-pull
resources.json: remote direct state serial=8 lineage="[UUID]"
[TEST_TMP_DIR]/.databricks/bundle/default/resources.json: local direct state serial=8 lineage="[UUID]"
