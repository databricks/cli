print_requests() {
    jq --sort-keys 'select(.method != "GET" and (.path | contains("/jobs")))' < out.requests.txt
    rm out.requests.txt
}

trace $CLI bundle validate
trace $CLI bundle validate -o json | jq .resources
errcode $CLI bundle plan &> out.plan.$DATABRICKS_CLI_DEPLOYMENT.txt
errcode $CLI bundle deploy &> out.deploy.$DATABRICKS_CLI_DEPLOYMENT.txt
print_requests &> out.deploy-requests.$DATABRICKS_CLI_DEPLOYMENT.txt
errcode $CLI bundle summary &> out.summary.$DATABRICKS_CLI_DEPLOYMENT.txt
$CLI bundle destroy --auto-approve &> out.destroy.$DATABRICKS_CLI_DEPLOYMENT.txt
print_requests &> out.destroy-requests.$DATABRICKS_CLI_DEPLOYMENT.txt
