mkdir output

function testCase() {
    project_name=$1

    trace $CLI bundle init default-python --config-file ./input.json
    trace cd $project_name

    trace uv venv --quiet
    trace uv pip install --quiet $DATABRICKS_BUNDLES_WHEEL

    # we check consistency only for 'resources'
    trace databricks bundle validate --output json | jq "pick(.resources)" > ../output/$project_name

    cd ..
    rm -rf $project_name
}

for include_notebook in yes no; do
  for include_python in yes no; do
    for include_dlt in yes no; do
      for serverless in yes no; do
        project_name="pydabs"
        [[ $include_notebook == yes ]] && project_name+="_notebook"
        [[ $include_python == yes ]] && project_name+="_python"
        [[ $include_dlt == yes ]] && project_name+="_dlt"
        [[ $serverless == yes ]] && project_name+="_serverless"

        include_notebook=$include_notebook \
        include_python=$include_python \
        include_dlt=$include_dlt \
        serverless=$serverless \
        project_name=$project_name \
        envsubst < input.json.tmpl > input.json

        echo "== $project_name =="
        testCase $project_name
      done
    done
  done
done