envsubst < input.json.tmpl > input.json
trace $CLI bundle init default-python --config-file ./input.json --output-dir .
rm input.json

trace diff.py $TESTDIR/../classic/output/my_default_python my_default_python*

cd my_default_python*

trap "trace $CLI bundle destroy -t dev --auto-approve" EXIT
trace $CLI bundle validate -t dev
trace $CLI bundle validate -t dev -o json > ../out.validate.dev.json
trace $CLI bundle deploy -t dev
trace $CLI bundle summary -t dev
trace $CLI bundle summary -t dev -o json > ../out.summary.dev.json

trace $CLI bundle destroy -t dev --auto-approve
trap "trace $CLI bundle destroy -t prod --auto-approve" EXIT

trace $CLI bundle validate -t prod
trace $CLI bundle validate -t prod -o json > ../out.validate.prod.json
trace $CLI bundle deploy -t prod
trace $CLI bundle summary -t prod
trace $CLI bundle summary -t prod -o json > ../out.summary.prod.json
trace $CLI bundle destroy -t prod --auto-approve
trap "true" EXIT

cd ..
rm -fr my_default_python*
