{
  "plan": {
    "resources.jobs.project_name_[UNIQUE_NAME]_job": {
      "depends_on": [
        {
          "node": "resources.pipelines.project_name_[UNIQUE_NAME]_pipeline",
          "label": "${resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.id}"
        }
      ],
      "action": "create",
      "new_state": {
        "config": {
          "deployment": {
            "kind": "BUNDLE",
            "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/state/metadata.json"
          },
          "edit_mode": "UI_LOCKED",
          "format": "MULTI_TASK",
          "job_clusters": [
            {
              "job_cluster_key": "job_cluster",
              "new_cluster": {
                "autoscale": {
                  "max_workers": 4,
                  "min_workers": 1
                },
                "data_security_mode": "SINGLE_USER",
                "node_type_id": "[NODE_TYPE_ID]",
                "num_workers": 0,
                "spark_version": "15.4.x-scala2.12"
              }
            }
          ],
          "max_concurrent_runs": 1,
          "name": "project_name_[UNIQUE_NAME]_job",
          "queue": {
            "enabled": true
          },
          "tasks": [
            {
              "depends_on": [
                {
                  "task_key": "refresh_pipeline"
                }
              ],
              "job_cluster_key": "job_cluster",
              "libraries": [
                {
                  "whl": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/artifacts/.internal/project_name_[UNIQUE_NAME]-0.0.1-py3-none-any.whl"
                }
              ],
              "python_wheel_task": {
                "entry_point": "main",
                "package_name": "project_name_[UNIQUE_NAME]"
              },
              "task_key": "main_task"
            },
            {
              "job_cluster_key": "job_cluster",
              "notebook_task": {
                "notebook_path": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/files/src/notebook"
              },
              "task_key": "notebook_task"
            },
            {
              "depends_on": [
                {
                  "task_key": "notebook_task"
                }
              ],
              "pipeline_task": {
                "pipeline_id": "${resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.id}"
              },
              "task_key": "refresh_pipeline"
            }
          ],
          "trigger": {
            "pause_status": "UNPAUSED",
            "periodic": {
              "interval": 1,
              "unit": "DAYS"
            }
          }
        },
        "vars": {
          "tasks[2].pipeline_task.pipeline_id": "${resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.id}"
        }
      }
    },
    "resources.jobs.project_name_[UNIQUE_NAME]_job.permissions": {
      "depends_on": [
        {
          "node": "resources.jobs.project_name_[UNIQUE_NAME]_job",
          "label": "${resources.jobs.project_name_[UNIQUE_NAME]_job.id}"
        }
      ],
      "action": "create",
      "new_state": {
        "config": {
          "object_id": "",
          "permissions": [
            {
              "permission_level": "IS_OWNER",
              "service_principal_name": "[USERNAME]"
            }
          ]
        },
        "vars": {
          "object_id": "/jobs/${resources.jobs.project_name_[UNIQUE_NAME]_job.id}"
        }
      }
    },
    "resources.pipelines.project_name_[UNIQUE_NAME]_pipeline": {
      "action": "create",
      "new_state": {
        "config": {
          "channel": "CURRENT",
          "configuration": {
            "bundle.sourcePath": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/files/src"
          },
          "deployment": {
            "kind": "BUNDLE",
            "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/state/metadata.json"
          },
          "edition": "ADVANCED",
          "libraries": [
            {
              "notebook": {
                "path": "/Workspace/Users/[USERNAME]/.bundle/project_name_[UNIQUE_NAME]/prod/files/src/pipeline"
              }
            }
          ],
          "name": "project_name_[UNIQUE_NAME]_pipeline",
          "schema": "project_name_[UNIQUE_NAME]_prod"
        }
      }
    },
    "resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.permissions": {
      "depends_on": [
        {
          "node": "resources.pipelines.project_name_[UNIQUE_NAME]_pipeline",
          "label": "${resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.id}"
        }
      ],
      "action": "create",
      "new_state": {
        "config": {
          "object_id": "",
          "permissions": [
            {
              "permission_level": "IS_OWNER",
              "service_principal_name": "[USERNAME]"
            }
          ]
        },
        "vars": {
          "object_id": "/pipelines/${resources.pipelines.project_name_[UNIQUE_NAME]_pipeline.id}"
        }
      }
    }
  }
}
