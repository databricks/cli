envsubst < $TESTDIR/../input.json.tmpl > input.json
trace $CLI bundle init default-python --config-file ./input.json

cd ./X*
trace yamlcheck.py
trace $CLI bundle validate -t dev
trace $CLI bundle validate -t prod

trace $CLI bundle validate -t dev -o json > tmp.plan.json 2> /dev/null
$TESTDIR/../check_output.py $CLI bundle deploy -t dev $(readplanarg tmp.plan.json)
trace $CLI bundle destroy -t dev --auto-approve 2>&1 | tail -n 2

trace $CLI bundle plan -t prod -o json > tmp.plan.json 2> /dev/null
$TESTDIR/../check_output.py $CLI bundle deploy -t prod $(readplanarg tmp.plan.json)
trace $CLI bundle destroy -t prod --auto-approve 2>&1 | tail -n 2

rm tmp.plan.json

cd ..
rm -fr X*
