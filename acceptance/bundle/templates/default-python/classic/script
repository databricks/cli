trace $CLI bundle init default-python --config-file ./input.json --output-dir output

cd output/my_default_python
trace $CLI bundle validate -t dev
trace $CLI bundle validate -t prod

trace $CLI bundle plan -t dev
trace $CLI bundle plan -t prod

$CLI bundle debug plan -t dev > ../../out.plan_dev.$DATABRICKS_BUNDLE_ENGINE.json
$CLI bundle debug plan -t prod > ../../out.plan_prod.$DATABRICKS_BUNDLE_ENGINE.json

rm ../../out.requests.txt
trace $CLI bundle deploy -t dev
print_requests.py --sort '^//import-file/' '^//telemetry-ext' > ../../out.requests.dev.$DATABRICKS_BUNDLE_ENGINE.txt

trace $CLI bundle deploy -t prod
print_requests.py --sort '^//import-file/' '^//telemetry-ext' > ../../out.requests.prod.$DATABRICKS_BUNDLE_ENGINE.txt

# Do not affect this repository's git behaviour #2318
mv .gitignore out.gitignore
rm -r .databricks dist

cd ../../

# Calculate the difference from the serverless template
diff.py $TESTDIR/../serverless/output output/ > out.compare-vs-serverless.diff
