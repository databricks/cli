trace $CLI bundle validate -o json | jq '{resources,variables}' > out.default.json

echo These fields exist in default target:
trace jq .resources.jobs.my_job.tasks[0].task_key out.default.json | grep "task with spark version 13.2.x-scala2.11 and jar /path/to/jar"
trace jq .resources.jobs.my_job.job_clusters[0].new_cluster.policy_id out.default.json | grep "some-policy-id"
trace jq .resources.jobs.my_job.job_clusters[0].new_cluster.spark_conf out.default.json

trace $CLI bundle validate -o json -t dev | jq '{resources,variables}' > out.dev.json

echo Both version and jar path changed in new target - adding grep would fail
trace jq .resources.jobs.my_job.tasks[0].task_key out.dev.json #| grep "task with spark version 14.2.x-scala2.11 and jar /newpath/to/jar"

echo This fields do not exist in dev target:
trace jq .resources.jobs.my_job.job_clusters[0].new_cluster.policy_id out.dev.json
trace jq .resources.jobs.my_job.job_clusters[0].new_cluster.spark_conf out.dev.json

echo Regression: libraries variable is not updated in dev target
trace jq '.variables.libraries.value[0]' out.dev.json #| grep newpath
trace jq .resources.jobs.my_job.tasks[0].libraries out.dev.json #| grep newpath
