envsubst < databricks.yml.tmpl > databricks.yml

cleanup() {
    trace $CLI bundle destroy --auto-approve
}
trap cleanup EXIT

trace $CLI bundle deploy

# Capture job ID and add to runtime replacements to avoid pattern matching ambiguity
job_id=$(read_id.py jobs some_other_job)
echo "$job_id:JOB_ID" >> ACC_REPLS

trace $CLI bundle run some_other_job
trace $CLI bundle run some_other_job --python-params=param1,param2
