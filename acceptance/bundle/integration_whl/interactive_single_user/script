export DATA_SECURITY_MODE=SINGLE_USER
envsubst < $TESTDIR/../interactive_cluster/databricks.yml.tmpl > databricks.yml
trace cat databricks.yml
cp -r $TESTDIR/../interactive_cluster/{setup.py,my_test_code} .
trap "errcode trace '$CLI' bundle destroy --auto-approve" EXIT
trace $CLI bundle deploy

# Add all resource IDs to runtime replacements to avoid pattern matching ambiguity
replace_ids.py

trace $CLI bundle run some_other_job > out.$DATABRICKS_BUNDLE_ENGINE.txt

title "Make a change to code without version change and run the job again"
update_file.py my_test_code/__main__.py 'Hello from my func' 'UPDATED MY FUNC'
trace $CLI bundle deploy
trace $CLI bundle run some_other_job >> out.$DATABRICKS_BUNDLE_ENGINE.txt
