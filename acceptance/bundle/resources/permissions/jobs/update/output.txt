
>>> [CLI] bundle plan
create jobs.job_with_permissions
create jobs.job_with_permissions.permissions

Plan: 2 to add, 0 to change, 0 to delete, 0 unchanged

>>> [CLI] bundle plan -o json

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged

>>> [CLI] bundle plan -o json

>>> [CLI] permissions get jobs [JOB_WITH_PERMISSIONS_ID]
{
  "access_control_list": [
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"CAN_VIEW"
        }
      ],
      "display_name":"viewer@example.com",
      "user_name":"viewer@example.com"
    },
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"CAN_MANAGE"
        }
      ],
      "group_name":"data-team"
    },
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"IS_OWNER"
        }
      ],
      "display_name":"[USERNAME]",
      "user_name":"[USERNAME]"
    },
    {
      "all_permissions": [
        {
          "inherited":true,
          "inherited_from_object": [
            "/jobs/"
          ],
          "permission_level":"CAN_MANAGE"
        }
      ],
      "group_name":"admins"
    }
  ],
  "object_id":"/jobs/[JOB_WITH_PERMISSIONS_ID]",
  "object_type":"job"
}

=== Update one permission and deploy again

>>> [CLI] bundle plan -o json

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged

=== Delete one permission and deploy again

>>> [CLI] bundle plan -o json

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged

=== Delete the whole block and deploy again

>>> [CLI] bundle plan -o json

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

=== Restore original config

>>> diff.py databricks.yml.saved databricks.yml
--- databricks.yml.saved
+++ databricks.yml
@@ -11,8 +11,3 @@
             notebook_path: /Workspace/Users/user@example.com/notebook
             source: WORKSPACE # otherwise TF implementation adds this to request and triggers diff
-      permissions: # PERMISSIONS
-        - level: CAN_VIEW # PERMISSIONS
-          user_name: viewer@example.com # PERMISSIONS
-        - level: CAN_MANAGE # DELETE_ONE
-          group_name: data-team # DELETE_ONE
           # permissions: [] # EXPLICIT_EMPTY

>>> [CLI] bundle plan -o json

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged

=== Set permissions: []

>>> [CLI] bundle plan -o json
Warning: unknown field: permissions
  at resources.jobs.job_with_permissions.permissions[1]
  in databricks.yml:18:11


>>> [CLI] bundle deploy
Warning: unknown field: permissions
  at resources.jobs.job_with_permissions.permissions[1]
  in databricks.yml:18:11

Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle destroy --auto-approve
Warning: unknown field: permissions
  at resources.jobs.job_with_permissions.permissions[1]
  in databricks.yml:18:11

The following resources will be deleted:
  delete resources.jobs.job_with_permissions

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/jobs-permissions-test/default

Deleting files...
Destroy complete!

>>> print_requests
