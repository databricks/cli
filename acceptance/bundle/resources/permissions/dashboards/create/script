if [ -z "$CLOUD_ENV" ]; then
    export TEST_USER_EMAIL="deco-test-user@databricks.com"
    export TEST_GROUP_NAME="deco-test-group"
    export TEST_SP_APPLICATION_ID="b16c7331-5226-468e-b082-8f5a8046e7b0"
fi

envsubst < databricks.yml.tmpl > databricks.yml

trace $CLI bundle validate -o json | jq .resources.dashboards.foo.permissions
rm out.requests.txt

$CLI bundle plan --output json > out.plan.$DATABRICKS_BUNDLE_ENGINE.json

rm out.requests.txt
trace $CLI bundle deploy

dashboard_id=$($CLI bundle summary --output json | jq -r '.resources.dashboards.foo.id')
echo "$dashboard_id:DASHBOARD_ID" >> ACC_REPLS

print_requests.py //permissions > out.requests.deploy.$DATABRICKS_BUNDLE_ENGINE.json

trace $CLI bundle destroy --auto-approve
print_requests.py //permissions > out.requests.destroy.$DATABRICKS_BUNDLE_ENGINE.json
