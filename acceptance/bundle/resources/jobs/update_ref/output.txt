
>>> [CLI] bundle plan
create jobs.bar
create jobs.foo

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-bundle/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests
{
  "body": {
    "deployment": {
      "kind": "BUNDLE",
      "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/test-bundle/default/state/metadata.json"
    },
    "edit_mode": "UI_LOCKED",
    "format": "MULTI_TASK",
    "job_clusters": [
      {
        "job_cluster_key": "key",
        "new_cluster": {
          "num_workers": 0,
          "spark_version": "13.3.x-scala2.12"
        }
      }
    ],
    "max_concurrent_runs": 1,
    "name": "foo",
    "queue": {
      "enabled": true
    },
    "trigger": {
      "pause_status": "UNPAUSED",
      "periodic": {
        "interval": 1,
        "unit": "DAYS"
      }
    }
  },
  "method": "POST",
  "path": "/api/2.2/jobs/create"
}
{
  "body": {
    "deployment": {
      "kind": "BUNDLE",
      "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/test-bundle/default/state/metadata.json"
    },
    "description": "depends on foo id [FOO_ID]",
    "edit_mode": "UI_LOCKED",
    "format": "MULTI_TASK",
    "max_concurrent_runs": 1,
    "name": "bar",
    "queue": {
      "enabled": true
    }
  },
  "method": "POST",
  "path": "/api/2.2/jobs/create"
}

>>> [CLI] bundle plan

=== Update trigger.periodic.unit and re-deploy
>>> update_file.py databricks.yml DAYS HOURS

>>> [CLI] bundle plan
update jobs.foo

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-bundle/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests
{
  "body": {
    "job_id": [FOO_ID],
    "new_settings": {
      "deployment": {
        "kind": "BUNDLE",
        "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/test-bundle/default/state/metadata.json"
      },
      "edit_mode": "UI_LOCKED",
      "format": "MULTI_TASK",
      "job_clusters": [
        {
          "job_cluster_key": "key",
          "new_cluster": {
            "num_workers": 0,
            "spark_version": "13.3.x-scala2.12"
          }
        }
      ],
      "max_concurrent_runs": 1,
      "name": "foo",
      "queue": {
        "enabled": true
      },
      "trigger": {
        "pause_status": "UNPAUSED",
        "periodic": {
          "interval": 1,
          "unit": "HOURS"
        }
      }
    }
  },
  "method": "POST",
  "path": "/api/2.2/jobs/reset"
}

>>> [CLI] bundle plan

=== Fetch job ID and verify remote state
>>> [CLI] jobs get [FOO_ID]
{
  "job_id":[FOO_ID],
  "settings": {
    "deployment": {
      "kind":"BUNDLE",
      "metadata_file_path":"/Workspace/Users/[USERNAME]/.bundle/test-bundle/default/state/metadata.json"
    },
    "edit_mode":"UI_LOCKED",
    "format":"MULTI_TASK",
    "job_clusters": [
      {
        "job_cluster_key":"key",
        "new_cluster": {
          "num_workers":0,
          "spark_version":"13.3.x-scala2.12"
        }
      }
    ],
    "max_concurrent_runs":1,
    "name":"foo",
    "queue": {
      "enabled":true
    },
    "trigger": {
      "pause_status":"UNPAUSED",
      "periodic": {
        "interval":1,
        "unit":"HOURS"
      }
    }
  }
}

>>> [CLI] jobs get [BAR_ID]
{
  "job_id":[BAR_ID],
  "settings": {
    "deployment": {
      "kind":"BUNDLE",
      "metadata_file_path":"/Workspace/Users/[USERNAME]/.bundle/test-bundle/default/state/metadata.json"
    },
    "description":"depends on foo id [FOO_ID]",
    "edit_mode":"UI_LOCKED",
    "format":"MULTI_TASK",
    "max_concurrent_runs":1,
    "name":"bar",
    "queue": {
      "enabled":true
    }
  }
}

=== Destroy the job and verify that it's removed from the state and from remote
>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete job bar
  delete job foo

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/test-bundle/default

Deleting files...
Destroy complete!

>>> print_sorted_requests
{
  "body": {
    "job_id": [FOO_ID]
  },
  "method": "POST",
  "path": "/api/2.2/jobs/delete"
}
{
  "body": {
    "job_id": [BAR_ID]
  },
  "method": "POST",
  "path": "/api/2.2/jobs/delete"
}

>>> musterr [CLI] jobs get [FOO_ID]
Error: Not Found

Exit code (musterr): 1

>>> musterr [CLI] jobs get [BAR_ID]
Error: Not Found

Exit code (musterr): 1
