export DASHBOARD_DISPLAY_NAME="test bundle-deploy-dashboard $UNIQUE_NAME)"
envsubst < databricks.yml.tmpl > databricks.yml

# Deploy the dashboard. The dashboard will be created but publish will fail because the warehouse does not exist.
errcode trace $CLI bundle deploy &> out.deploy.$DATABRICKS_BUNDLE_ENGINE.txt

trace $CLI bundle summary

# API should record a DELETE call to clean up the draft dashboard that was not published.
trace cat out.requests.txt | jq 'select(.method == "POST" or .method == "PATCH" or .method == "DELETE")' | jq 'select( (.path | contains("/api/2.0/lakeview/dashboards")) or ((.path == "/api/2.0/workspace/mkdirs") and (.body.path | contains("/default/resources"))))' > out.requests.$DATABRICKS_BUNDLE_ENGINE.txt
rm out.requests.txt
