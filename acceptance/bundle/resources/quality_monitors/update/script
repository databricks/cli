echo "*" > .gitignore
trace $CLI bundle deploy

print_requests() {
    jq 'select(.method != "GET" and (.path | contains("/unity-catalog/tables")))' < out.requests.txt
    rm out.requests.txt
}

trace print_requests
read_state.py quality_monitors monitor1 output_schema_name

title "Update output_schema_name and re-deploy"
trace update_file.py databricks.yml main.output1 main.output2
trace $CLI bundle deploy
trace print_requests
read_state.py quality_monitors monitor1 output_schema_name

title "Restore output_schema_name to original value and re-deploy"
trace update_file.py databricks.yml main.output2 main.output1
trace $CLI bundle deploy
trace print_requests
read_state.py quality_monitors monitor1 output_schema_name
