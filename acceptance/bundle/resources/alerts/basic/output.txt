
>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/alerts-basic-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> [CLI] alerts-v2 get-alert [ALERT_ID]
{
  "display_name": "My alert",
  "lifecycle_state": "ACTIVE",
  "custom_summary": "My alert",
  "evaluation": {
    "comparison_operator": "EQUAL",
    "notification": {
      "notify_on_ok": false,
      "retrigger_seconds": 1
    },
    "source": {
      "aggregation": "MAX",
      "display": "1",
      "name": "1"
    },
    "threshold": {
      "value": {
        "double_value": 2
      }
    }
  },
  "query_text": "select 2",
  "schedule": {
    "pause_status": "UNPAUSED",
    "quartz_cron_schedule": "44 19 */1 * * ?",
    "timezone_id": "Europe/Amsterdam"
  },
  "warehouse_id": "[TEST_DEFAULT_WAREHOUSE_ID]"
}

=== assert that permissions are applied
>>> [CLI] permissions get alertsv2 [ALERT_ID]
{
  "user_name": "deco-test-user@databricks.com",
  "all_permissions": [
    {
      "inherited": false,
      "permission_level": "CAN_MANAGE"
    }
  ]
}

=== assert that no permanent drift happens
>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged

>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete resources.alerts.myalert

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/alerts-basic-[UNIQUE_NAME]/default

Deleting files...
Destroy complete!

>>> [CLI] alerts-v2 get-alert [ALERT_ID]
{
  "display_name": "My alert",
  "lifecycle_state": "DELETED"
}

>>> [CLI] bundle summary
Name: alerts-basic-[UNIQUE_NAME]
Target: default
Workspace:
  User: [USERNAME]
  Path: /Workspace/Users/[USERNAME]/.bundle/alerts-basic-[UNIQUE_NAME]/default
Resources:
  Alerts:
    myalert:
      Name: My alert
      URL:  (not deployed)
