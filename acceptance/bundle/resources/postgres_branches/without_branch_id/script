envsubst < databricks.yml.tmpl > databricks.yml

cleanup() {
   $CLI bundle destroy --auto-approve > /dev/null 2>&1 || true
}
trap cleanup EXIT

trace $CLI bundle validate

# Deploy output differs between engines, so capture to per-engine file only
$CLI bundle deploy > out.deploy.$DATABRICKS_BUNDLE_ENGINE.txt 2>&1 || true
