envsubst < databricks.yml.tmpl > databricks.yml

trace $CLI bundle debug plan > out.plan1.$DATABRICKS_BUNDLE_ENGINE.json
trace print_requests.py /permissions > out.plan1.requests.$DATABRICKS_BUNDLE_ENGINE.json
trace $CLI bundle deploy
trace print_requests.py /permissions > out.deploy1.requests.$DATABRICKS_BUNDLE_ENGINE.json

update_file.py databricks.yml '["USE_SCHEMA"]' '["CREATE_VOLUME", "MANAGE"]'
update_file.py databricks.yml USE_SCHEMA APPLY_TAG

trace $CLI bundle debug plan > out.plan2.$DATABRICKS_BUNDLE_ENGINE.json
trace print_requests.py /permissions > out.plan2.requests.$DATABRICKS_BUNDLE_ENGINE.json
trace $CLI bundle deploy
trace print_requests.py /permissions > out.deploy2.requests.$DATABRICKS_BUNDLE_ENGINE.json

trace $CLI bundle destroy --auto-approve
trace print_requests.py /permissions > out.destroy.requests.$DATABRICKS_BUNDLE_ENGINE.json
