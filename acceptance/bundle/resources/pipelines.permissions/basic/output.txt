
>>> [CLI] bundle debug plan

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

>>> [CLI] permissions get pipelines [PIPELINE_ID]
{
  "access_control_list": [
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"CAN_VIEW"
        }
      ],
      "user_name":"viewer@example.com"
    },
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"CAN_MANAGE"
        }
      ],
      "group_name":"data-team"
    },
    {
      "all_permissions": [
        {
          "inherited":false,
          "permission_level":"IS_OWNER"
        }
      ],
      "user_name":"[USERNAME]"
    }
  ],
  "object_id":"/pipelines/[PIPELINE_ID]",
  "object_type":"pipelines"
}

=== Update one permission and deploy again

>>> [CLI] bundle debug plan

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

=== Delete one permission and deploy again

>>> [CLI] bundle debug plan

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

=== Delete the whole block and deploy again

>>> cat databricks.yml
bundle:
  name: permissions-test

resources:
  pipelines:
    foo:
      name: foo

>>> [CLI] bundle debug plan

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_sorted_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

=== Restore original config

>>> [CLI] bundle debug plan

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/permissions-test/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests

>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete pipeline foo

This action will result in the deletion of the following Lakeflow Declarative Pipelines along with the
Streaming Tables (STs) and Materialized Views (MVs) managed by them:
  delete pipeline foo

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/permissions-test/default

Deleting files...
Destroy complete!
