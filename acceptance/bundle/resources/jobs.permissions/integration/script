print_requests() {
    jq 'select(.path | contains("/jobs/")) | select(.method != "GET")' < out.requests.txt
    rm out.requests.txt
}

print_sorted_requests() {
    jq -c < out.requests.txt | sort | jq --sort-keys 'select(.path | contains("/jobs/")) | select(.method != "GET")'
    rm out.requests.txt
}

trace $CLI users create --id test-delete-me-$UNIQUE_NAME@databricks.com --user-name test-delete-me-$UNIQUE_NAME@databricks.com > /dev/null
envsubst < databricks.yml.tmpl > databricks.yml
trace $CLI bundle plan
$CLI bundle debug plan > out.plan_create.$DATABRICKS_BUNDLE_ENGINE.json
trace $CLI bundle deploy
trace print_requests > out.requests_create.json

JOB_ID=$($CLI bundle summary -o json | jq -r '.resources.jobs.foo.id')
echo "$JOB_ID:JOB_ID" >> ACC_REPLS
trace $CLI permissions get jobs $JOB_ID
rm out.requests.txt
