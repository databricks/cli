
=== create secret scope with permissions
>>> [CLI] bundle plan
create secret_scopes.my_scope

Plan: 1 to add, 0 to change, 0 to delete, 0 unchanged

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/secret-scope-permissions-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> [CLI] secrets list-scopes -o json
{
  "backend_type": "DATABRICKS",
  "name": "test-scope-permissions-[UNIQUE_NAME]"
}

>>> [CLI] secrets list-acls test-scope-permissions-[UNIQUE_NAME]
{"permission":"MANAGE","principal":"[USERNAME]"}
{"permission":"MANAGE","principal":"deco-test-group"}
{"permission":"READ","principal":"deco-test-user@databricks.com"}
{"permission":"WRITE","principal":"[TEST_SP_APPLICATION_ID]"}

=== update permissions (remove sp, change permission for user, add users and remove deco-test-group)
>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/secret-scope-permissions-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> [CLI] secrets list-acls test-scope-permissions-[UNIQUE_NAME]
{"permission":"MANAGE","principal":"[USERNAME]"}
{"permission":"MANAGE","principal":"users"}
{"permission":"WRITE","principal":"deco-test-user@databricks.com"}

=== change scope name (should recreate scope and update permissions)
>>> [CLI] bundle plan
Plan: 0 to add, 0 to change, 0 to delete, 1 unchanged

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/secret-scope-permissions-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> [CLI] secrets list-scopes -o json
{
  "backend_type": "DATABRICKS",
  "name": "test-scope-permissions-[UNIQUE_NAME]"
}

>>> [CLI] secrets list-acls test-scope-permissions-[UNIQUE_NAME]
{"permission":"MANAGE","principal":"[USERNAME]"}
{"permission":"MANAGE","principal":"users"}
{"permission":"WRITE","principal":"deco-test-user@databricks.com"}

>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete secret_scope my_scope

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/secret-scope-permissions-[UNIQUE_NAME]/default

Deleting files...
Destroy complete!
