
=== Initial summary for resource, before the deployment
>>> [CLI] bundle summary -o json
{
  "catalog_name": "main",
  "comment": "COMMENT1",
  "modified_status": "created",
  "name": "myvolume",
  "schema_name": "myschema",
  "volume_type": "MANAGED"
}

=== Verify volume does not exist
>>> musterr [CLI] volumes read main.myschema.myvolume
Error: Resource catalog.VolumeInfo not found: main.myschema.myvolume

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-bundle/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests
{
  "method": "POST",
  "path": "/api/2.1/unity-catalog/volumes",
  "body": {
    "catalog_name": "main",
    "comment": "COMMENT1",
    "name": "myvolume",
    "schema_name": "myschema",
    "volume_type": "MANAGED"
  }
}

=== Summary should now show id and url
"main.myschema.myvolume"
"[DATABRICKS_URL]/explore/data/volumes/main/myschema/myvolume?o=[NUMID]"

=== Verify deployment
>>> [CLI] volumes read main.myschema.myvolume
{
  "catalog_name":"main",
  "comment":"COMMENT1",
  "created_at":[UNIX_TIME_MILLIS][0],
  "created_by":"[USERNAME]",
  "full_name":"main.myschema.myvolume",
  "name":"myvolume",
  "owner":"[USERNAME]",
  "schema_name":"myschema",
  "storage_location":"s3://deco-uc-prod-isolated-aws-us-east-1/metastore/[UUID]/volumes/[UUID]",
  "updated_at":[UNIX_TIME_MILLIS][0],
  "volume_type":"MANAGED"
}

=== Update comment
>>> update_file.py databricks.yml COMMENT1 COMMENT2

=== Summary should show modified_status=modified and show the same id
{
  "catalog_name": "main",
  "comment": "COMMENT2",
  "id": "main.myschema.myvolume",
  "name": "myvolume",
  "schema_name": "myschema",
  "url": "[DATABRICKS_URL]/explore/data/volumes/main/myschema/myvolume?o=[NUMID]",
  "volume_type": "MANAGED"
}

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-bundle/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests
{
  "method": "PATCH",
  "path": "/api/2.1/unity-catalog/volumes/main.myschema.myvolume",
  "body": {
    "comment": "COMMENT2"
  }
}

=== Verify updated deployment: should show new comment
>>> [CLI] volumes read main.myschema.myvolume
"COMMENT2"

>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete resources.volumes.volume1

This action will result in the deletion of the following volumes.
For managed volumes, the files stored in the volume are also deleted from your
cloud tenant within 30 days. For external volumes, the metadata about the volume
is removed from the catalog, but the underlying files are not deleted:
  delete resources.volumes.volume1

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/test-bundle/default

Deleting files...
Destroy complete!

>>> print_requests
{
  "method": "DELETE",
  "path": "/api/2.1/unity-catalog/volumes/main.myschema.myvolume"
}

>>> musterr [CLI] volumes read main.myschema.myvolume
Error: Resource catalog.VolumeInfo not found: main.myschema.myvolume
{
  "catalog_name": "main",
  "comment": "COMMENT2",
  "modified_status": "created",
  "name": "myvolume",
  "schema_name": "myschema",
  "volume_type": "MANAGED"
}
