export ENDPOINT_NAME="test-endpoint-$UNIQUE_NAME-1"

envsubst < databricks.yml.tmpl > databricks.yml

cleanup() {
    trace $CLI bundle destroy --auto-approve
    rm out.requests.txt
}
trap cleanup EXIT

trace $CLI bundle debug plan
trace $CLI bundle deploy

trace print_requests.py //serving-endpoints

echo "$ENDPOINT_NAME:ENDPOINT_NAME_1" >> ACC_REPLS
trace $CLI serving-endpoints get $ENDPOINT_NAME | jq '{name, creator}'

export ENDPOINT_NAME="test-endpoint-$UNIQUE_NAME-2"
envsubst < databricks.yml.tmpl > databricks.yml
trace $CLI bundle debug plan
trace $CLI bundle deploy

trace print_requests.py //serving-endpoints

echo "$ENDPOINT_NAME:ENDPOINT_NAME_2" >> ACC_REPLS
trace $CLI serving-endpoints get $ENDPOINT_NAME | jq '{name, creator}'
