
>>> [CLI] bundle debug plan
{
  "plan": {
    "resources.model_serving_endpoints.my_endpoint": {
      "action": "create",
      "new_state": {
        "config": {
          "name": "[ENDPOINT_NAME_1]"
        }
      }
    },
    "resources.model_serving_endpoints.my_endpoint.permissions": {
      "depends_on": [
        {
          "node": "resources.model_serving_endpoints.my_endpoint",
          "label": "${resources.model_serving_endpoints.my_endpoint.endpoint_id}"
        }
      ],
      "action": "create",
      "new_state": {
        "config": {
          "object_id": "",
          "permissions": [
            {
              "permission_level": "CAN_VIEW",
              "user_name": "[TEST_USER_EMAIL]"
            },
            {
              "permission_level": "CAN_MANAGE",
              "user_name": "[USERNAME]"
            }
          ]
        },
        "vars": {
          "object_id": "/serving-endpoints/${resources.model_serving_endpoints.my_endpoint.endpoint_id}"
        }
      }
    }
  }
}

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/acc-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests.py //serving-endpoints
{
  "method": "POST",
  "path": "/api/2.0/serving-endpoints",
  "body": {
    "name": "[ENDPOINT_NAME_1]"
  }
}
{
  "method": "PUT",
  "path": "/api/2.0/permissions/serving-endpoints/[ENDPOINT_ID_1]",
  "body": {
    "access_control_list": [
      {
        "permission_level": "CAN_VIEW",
        "user_name": "[TEST_USER_EMAIL]"
      },
      {
        "permission_level": "CAN_MANAGE",
        "user_name": "[USERNAME]"
      }
    ]
  }
}

=== Print the GET endpoint details
{
  "name": "[ENDPOINT_NAME_1]",
  "creator": "[USERNAME]"
}

>>> [CLI] bundle debug plan
{
  "plan": {
    "resources.model_serving_endpoints.my_endpoint": {
      "action": "recreate",
      "new_state": {
        "config": {
          "name": "[ENDPOINT_NAME_2]"
        }
      },
      "changes": {
        "local": {
          "name": {
            "action": "recreate"
          }
        }
      }
    },
    "resources.model_serving_endpoints.my_endpoint.permissions": {
      "depends_on": [
        {
          "node": "resources.model_serving_endpoints.my_endpoint",
          "label": "${resources.model_serving_endpoints.my_endpoint.endpoint_id}"
        }
      ],
      "action": "update",
      "new_state": {
        "config": {
          "object_id": "",
          "permissions": [
            {
              "permission_level": "CAN_VIEW",
              "user_name": "[TEST_USER_EMAIL]"
            },
            {
              "permission_level": "CAN_MANAGE",
              "user_name": "[USERNAME]"
            }
          ]
        },
        "vars": {
          "object_id": "/serving-endpoints/${resources.model_serving_endpoints.my_endpoint.endpoint_id}"
        }
      },
      "remote_state": {
        "object_id": "/serving-endpoints/[ENDPOINT_ID_1]",
        "permissions": [
          {
            "permission_level": "CAN_VIEW",
            "user_name": "[TEST_USER_EMAIL]"
          },
          {
            "permission_level": "CAN_MANAGE",
            "service_principal_name": "[USERNAME]"
          }
        ]
      },
      "changes": {
        "local": {
          "object_id": {
            "action": "update"
          }
        },
        "remote": {
          "permissions[1].service_principal_name": {
            "action": "skip",
            "reason": "server_side_default"
          },
          "permissions[1].user_name": {
            "action": "update"
          }
        }
      }
    }
  }
}

>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/acc-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests.py //serving-endpoints
{
  "method": "DELETE",
  "path": "/api/2.0/serving-endpoints/[ENDPOINT_NAME_1]"
}
{
  "method": "POST",
  "path": "/api/2.0/serving-endpoints",
  "body": {
    "name": "[ENDPOINT_NAME_2]"
  }
}
{
  "method": "PUT",
  "path": "/api/2.0/permissions/serving-endpoints/[ENDPOINT_ID_2]",
  "body": {
    "access_control_list": [
      {
        "permission_level": "CAN_VIEW",
        "user_name": "[TEST_USER_EMAIL]"
      },
      {
        "permission_level": "CAN_MANAGE",
        "user_name": "[USERNAME]"
      }
    ]
  }
}

=== Print the GET endpoint details
{
  "name": "[ENDPOINT_NAME_2]",
  "creator": "[USERNAME]"
}

>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete model_serving_endpoint my_endpoint

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/acc-[UNIQUE_NAME]/default

Deleting files...
Destroy complete!
