
echo "*" > .gitignore
trace $CLI bundle plan
trace $CLI bundle deploy
trace print_requests.py //jobs > out.deploy1.requests.json

foo_id=`read_id.py jobs foo`
echo "$foo_id:FOO_ID" >> ACC_REPLS

bar_id=`read_id.py jobs bar`
echo "$bar_id:BAR_ID" >> ACC_REPLS

trace $CLI bundle plan  # empty

title "Update trigger.periodic.unit and re-deploy; jobs.bar is unchanged"
trace update_file.py databricks.yml DAYS HOURS
trace $CLI bundle plan
trace $CLI bundle deploy
# per-engine output file because terraform adds output-only and server-side defaults fields into request and direct does not
trace print_requests.py //jobs > out.deploy2.requests.$DATABRICKS_BUNDLE_ENGINE.json
trace $CLI bundle plan

title "Fetch job ID and verify remote state"

# Badness: output should not be different per engine; investigate if it's the same on cloud
trace $CLI jobs get $foo_id > out.get_foo.$DATABRICKS_BUNDLE_ENGINE.json
trace $CLI jobs get $bar_id
rm out.requests.txt

trace $CLI bundle destroy --auto-approve
trace print_requests.py //jobs

trace musterr $CLI jobs get $foo_id
trace musterr $CLI jobs get $bar_id
rm out.requests.txt
