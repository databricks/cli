cp $TESTDIR/../databricks.yml .
cp $TESTDIR/../empty.yml .
echo "*" > .gitignore

trace $CLI bundle deploy
trace print_requests.py --sort //jobs

# Capture all job IDs
for name in independent1 independent2 chain_bottom chain_mid chain_top diamond_bottom diamond_left diamond_right diamond_top multi_parent1 multi_parent2 multi_child; do
  id=`read_id.py jobs $name`
  upper=$(echo $name | tr '[:lower:]' '[:upper:]')
  echo "$id:${upper}_ID" >> ACC_REPLS
done

# Sanity check plan after deploy
trace $CLI bundle plan > out.plan_sanity.$DATABRICKS_BUNDLE_ENGINE.txt

title "Delete all via empty.yml"
cp empty.yml databricks.yml
trace $CLI bundle plan > out.plan_delete.$DATABRICKS_BUNDLE_ENGINE.txt
trace $CLI bundle deploy

trace $CLI bundle destroy --auto-approve
rm -f out.requests.txt
