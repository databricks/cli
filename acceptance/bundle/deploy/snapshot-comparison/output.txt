
=== Deploy bundle 1 with terraform
>>> DATABRICKS_BUNDLE_ENGINE=terraform [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/snapshot-test-1-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

=== Run migrate on bundle 1
>>> [CLI] bundle deployment migrate
Note: Migration should be done after a full deploy. Running plan now to verify that deployment was done:
Plan: 0 to add, 0 to change, 0 to delete, 2 unchanged
Success! Migrated 2 resources to direct engine state file: [TEST_TMP_DIR]/bundle1/.databricks/bundle/default/resources.json

Validate the migration by running "databricks bundle plan", there should be no actions planned.

The state file is not synchronized to the workspace yet. To do that and finalize the migration, run "bundle deploy".

To undo the migration, remove [TEST_TMP_DIR]/bundle1/.databricks/bundle/default/resources.json and rename [TEST_TMP_DIR]/bundle1/.databricks/bundle/default/terraform/terraform.tfstate.backup to [TEST_TMP_DIR]/bundle1/.databricks/bundle/default/terraform/terraform.tfstate


=== Deploy bundle 2 with terraform and YamlSync
>>> DATABRICKS_BUNDLE_ENABLE_EXPERIMENTAL_YAML_SYNC=true DATABRICKS_BUNDLE_ENGINE=terraform [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/snapshot-test-2-[UNIQUE_NAME]/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

=== Normalize bundle names for comparison
>>> cp bundle1/.databricks/bundle/default/resources.json out.bundle1.json

>>> cp bundle2/.databricks/bundle/default/resources-config-sync-snapshot.json out.bundle2.json

>>> update_file.py out.bundle1.json snapshot-test-1- snapshot-test-NORMALIZED-

>>> update_file.py out.bundle2.json snapshot-test-2- snapshot-test-NORMALIZED-

=== Compare normalized snapshots
>>> diff.py out.bundle1.json out.bundle2.json

=== Cleanup bundle 1
>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete resources.jobs.test_job
  delete resources.pipelines.test_pipeline

This action will result in the deletion of the following Lakeflow Spark Declarative Pipelines along with the
Streaming Tables (STs) and Materialized Views (MVs) managed by them:
  delete resources.pipelines.test_pipeline

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/snapshot-test-1-[UNIQUE_NAME]/default

Deleting files...
Destroy complete!

=== Cleanup bundle 2
>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete resources.jobs.test_job
  delete resources.pipelines.test_pipeline

This action will result in the deletion of the following Lakeflow Spark Declarative Pipelines along with the
Streaming Tables (STs) and Materialized Views (MVs) managed by them:
  delete resources.pipelines.test_pipeline

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/snapshot-test-2-[UNIQUE_NAME]/default

Deleting files...
Destroy complete!
