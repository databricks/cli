DASHBOARD_DISPLAY_NAME="test dashboard $UNIQUE_NAME"

export DASHBOARD_DISPLAY_NAME
envsubst < databricks.yml.tmpl > databricks.yml

# Create a pre-defined dashboard:
DASHBOARD_ID=$($CLI lakeview create --display-name "${DASHBOARD_DISPLAY_NAME}" --warehouse-id "${TEST_DEFAULT_WAREHOUSE_ID}" --serialized-dashboard '{"pages":[{"name":"02724bf2","displayName":"Untitled page"}]}' | jq -r '.dashboard_id')

cleanupRemoveDashboard() {
    $CLI lakeview trash "${DASHBOARD_ID}"
}
trap cleanupRemoveDashboard EXIT

trace $CLI bundle deployment bind dashboard1 "${DASHBOARD_ID}" --auto-approve

trace errcode $CLI bundle deploy

trace $CLI bundle deployment unbind dashboard1

trace $CLI bundle deploy --auto-approve

trace $CLI lakeview get "${DASHBOARD_ID}" | jq '{display_name, lifecycle_state}'
