CATALOG_NAME="main"
SCHEMA_NAME="default"
VOLUME_NAME="fs-cp-test-${UNIQUE_NAME}"

cleanup() {
  $CLI volumes delete "${CATALOG_NAME}.${SCHEMA_NAME}.${VOLUME_NAME}" 2>/dev/null || true
}
trap cleanup EXIT

# Create volume for testing.
$CLI volumes create "${CATALOG_NAME}" "${SCHEMA_NAME}" "${VOLUME_NAME}" MANAGED >/dev/null

# Create parent directory.
$CLI fs mkdir dbfs:/Volumes/${CATALOG_NAME}/${SCHEMA_NAME}/${VOLUME_NAME}

# Upload local file to volume.
trace $CLI fs cp local.txt dbfs:/Volumes/${CATALOG_NAME}/${SCHEMA_NAME}/${VOLUME_NAME}/uploaded.txt

# Verify file was uploaded correctly.
trace $CLI fs cat dbfs:/Volumes/${CATALOG_NAME}/${SCHEMA_NAME}/${VOLUME_NAME}/uploaded.txt

# Download the same file back to verify round-trip.
trace $CLI fs cp dbfs:/Volumes/${CATALOG_NAME}/${SCHEMA_NAME}/${VOLUME_NAME}/uploaded.txt downloaded.txt

# Verify downloaded content matches original.
trace cat downloaded.txt
rm downloaded.txt
