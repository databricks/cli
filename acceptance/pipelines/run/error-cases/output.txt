
=== install pipelines cli
>>> [CLI] install-pipelines-cli -d ./subdir
pipelines successfully installed in directory "./subdir"

=== deploy pipeline
>>> [CLI] bundle deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default/files...
Deploying resources...
Updating deployment state...
Deployment complete!

>>> print_requests
{
  "body": {
    "channel": "CURRENT",
    "deployment": {
      "kind": "BUNDLE",
      "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default/state/metadata.json"
    },
    "edition": "ADVANCED",
    "libraries": [
      {
        "file": {
          "path": "/Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default/files/pipeline_file.py"
        }
      }
    ],
    "name": "test-pipeline-errors"
  },
  "method": "POST",
  "path": "/api/2.0/pipelines"
}
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== test error: --refresh-all and --refresh together
>>> ./subdir/pipelines run my_pipeline --refresh-all --refresh table1
Error: pipeline run arguments are mutually exclusive (got --refresh-all, --refresh)

Exit code: 1

>>> print_requests
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== test error: --full-refresh-all and --full-refresh together
>>> ./subdir/pipelines run my_pipeline --full-refresh-all --full-refresh table1
Error: pipeline run arguments are mutually exclusive (got --full-refresh-all, --full-refresh)

Exit code: 1

>>> print_requests
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== test error: --refresh-all and --full-refresh-all together
>>> ./subdir/pipelines run my_pipeline --refresh-all --full-refresh-all
Error: pipeline run arguments are mutually exclusive (got --refresh-all, --full-refresh-all)

Exit code: 1

>>> print_requests
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== test error: --refresh and --full-refresh together
>>> ./subdir/pipelines run my_pipeline --refresh table1 --full-refresh table2
Error: pipeline run arguments are mutually exclusive (got --refresh, --full-refresh)

Exit code: 1

>>> print_requests
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== test valid combination: --no-wait with --refresh-all
>>> ./subdir/pipelines run my_pipeline --no-wait --refresh-all
Update URL: [DATABRICKS_URL]/#joblist/pipelines/[UUID]/updates/[UUID]


>>> print_requests
{
  "body": {},
  "method": "POST",
  "path": "/api/2.0/pipelines/[UUID]/updates"
}
pipelines my_pipeline id='[UUID]' name='test-pipeline-errors'

=== Fetch pipeline ID and verify remote state
>>> [CLI] pipelines get [UUID]
{
  "creator_user_name":"[USERNAME]",
  "last_modified":[UNIX_TIME_MILLIS],
  "name":"test-pipeline-errors",
  "pipeline_id":"[UUID]",
  "run_as_user_name":"[USERNAME]",
  "spec": {
    "channel":"CURRENT",
    "deployment": {
      "kind":"BUNDLE",
      "metadata_file_path":"/Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default/state/metadata.json"
    },
    "edition":"ADVANCED",
    "id":"[UUID]",
    "libraries": [
      {
        "file": {
          "path":"/Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default/files/pipeline_file.py"
        }
      }
    ],
    "name":"test-pipeline-errors",
    "storage":"dbfs:/pipelines/[UUID]"
  },
  "state":"IDLE"
}

=== Destroy the pipeline and verify that it's removed from the state and from remote
>>> [CLI] bundle destroy --auto-approve
The following resources will be deleted:
  delete pipeline my_pipeline

All files and directories at the following location will be deleted: /Workspace/Users/[USERNAME]/.bundle/test-pipeline-run-errors/default

Deleting files...
Destroy complete!

>>> print_requests
{
  "method": "DELETE",
  "path": "/api/2.0/pipelines/[UUID]"
}
State not found for pipelines.my_pipeline

>>> musterr [CLI] pipelines get [UUID]
Error: The specified pipeline [UUID] was not found.

Exit code (musterr): 1
