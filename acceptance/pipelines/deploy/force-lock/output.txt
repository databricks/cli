
=== install pipelines cli
>>> errcode [CLI] install-pipelines-cli -d ./subdir
pipelines successfully installed in directory "./subdir"

>>> ./subdir/pipelines deploy
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-pipeline-force-lock/development/files...
Deploying resources...
Updating deployment state...
Deployment complete!

=== Assert the pipeline is created
>>> [CLI] pipelines get [UUID]
{
  "spec": {
    "catalog": "main",
    "channel": "CURRENT",
    "deployment": {
      "kind": "BUNDLE",
      "metadata_file_path": "/Workspace/Users/[USERNAME]/.bundle/test-pipeline-force-lock/development/state/metadata.json"
    },
    "development": true,
    "edition": "ADVANCED",
    "id": "[UUID]",
    "libraries": [
      {
        "notebook": {
          "path": "/Workspace/Users/[USERNAME]/.bundle/test-pipeline-force-lock/development/files/nb"
        }
      }
    ],
    "name": "test-pipeline",
    "target": "main.test-schema"
  }
}

=== Try to redeploy with --force-lock - should succeed even if lock exists
>>> ./subdir/pipelines deploy --force-lock --auto-approve
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-pipeline-force-lock/development/files...
Deploying resources...
Updating deployment state...
Deployment complete!

=== Try to redeploy with different catalog using --force-lock
>>> ./subdir/pipelines deploy --force-lock --var=catalog=another_catalog --auto-approve
Uploading bundle files to /Workspace/Users/[USERNAME]/.bundle/test-pipeline-force-lock/development/files...
The following UC schemas will be deleted or recreated. Any underlying data may be lost:
  recreate schema bar

This action will result in the deletion or recreation of the following DLT Pipelines along with the
Streaming Tables (STs) and Materialized Views (MVs) managed by them. Recreating the Pipelines will
restore the defined STs and MVs through full refresh. Note that recreation is necessary when pipeline
properties such as the 'catalog' or 'storage' are changed:
  recreate pipeline foo
Deploying resources...
Updating deployment state...
Deployment complete!
