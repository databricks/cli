# Test using credentials from a profile with unified host settings
# Unset the token which is configured by default in acceptance tests
export DATABRICKS_TOKEN=""

# Create a config file with unified host profile settings
# Use the test server host but configure it as a unified host
sethome "./home"
cat > "./home/.databrickscfg" <<EOF
[unified-workspace]
host = $DATABRICKS_HOST
token = dapi-unified-token
account_id = test-account-123
workspace_id = 1234567890
experimental_is_unified_host = true

[unified-account]
host = $DATABRICKS_HOST
token = dapi-unified-account-token
account_id = test-account-456
experimental_is_unified_host = true
EOF

title "Use unified host profile with workspace_id"
trace $CLI current-user me -p unified-workspace

title "Use unified host profile for account-level (no workspace_id)"
trace $CLI current-user me -p unified-account
